<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>

    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/startbootstrap/css/styles.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <link rel="stylesheet" href="/pages/orders/styles.css"/>

    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom fixed-top">
        <div class="container px-5">
            <a class="navbar-brand">Backend.Food</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link">Log In</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead text-black align-content-center h-100">
        <div class="masthead-content h-100">
            <div class="h-100 w-100 container bg-white rounded-5 p-5" >
                <div class="text-center w-100">
                    <h2>
                        <%= allowJoin ? 'Your Orders' : 'All Orders' %>
                    </h2>
                    <hr>
                </div>
                <div class="flex-grow-1 d-flex flex-column justify-content-start align-items-center overflow-y-scroll no-wrap p-3">
                    <div id="orders-parent" class="w-100 scroll">
                        <% for(let i = 0; i < orders.length; i++ ) { %>
                            <% const current = orders[i] %>
                            <div class="card w-100 mt-3 mb-3 d-flex flex-column justify-content-evenly align-items-baseline">
                                <div class="card-body w-100">
                                    <div class="w-100 p-0 d-flex justify-content-evenly">
                                        <div class="w-50 overflow-x-scroll no-wrap">
                                            <h3 class="card-title m-0"> Order ID: <%= current.id %> </h3>
                                        </div>
                                        <div class="w-50 overflow-x-scroll no-wrap text-end p-2">
                                            <h6 class="card-title m-0"> Created On: <strong> <%= current.createdOn %> </strong> By <strong> <%= current.authorName %> </strong></h6>
                                        </div>
                                    </div>
                                    <div class="w-100 p-0 d-flex justify-content-evenly">
                                        <div class="w-50 d-flex justify-content-evenly overflow-x-scroll no-wrap">
                                            <% if(current.status === 'ordered') { %>
                                                <span class="p-2 rounded-2 text-center text-warning-emphasis text-bg-warning fw-bold ms-1 me-1">Ordered</span>
                                                <span class="p-2 rounded-2 text-success fw-bold ms-1 me-1">Processing</span>
                                            <% } else { %>
                                                <span class="p-2 rounded-2 text-warning fw-bold ms-1 me-1">Ordered</span>
                                                <span class="p-2 rounded-2 text-success-emphasis text-bg-success fw-bold ms-1 me-1">Completed</span>
                                            <% } %>
                                        </div>
                                        <div class="w-50 text-end">
                                            <button onclick="window.location.href = '/order/<%= current.id %>/<%= current.authorName %>'" class="btn text-primary-emphasis text-bg-primary fw-bold ms-1 me-1">Join</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
                <% if (allowJoin) { %>
                    <hr class="w-100">
                    <form class="d-flex justify-content-evenly align-items-center">
                        <div>
                            <label for="id" class="form-label">Order ID</label>
                            <input type="number" name="id" class="form-control" id="id" placeholder="Enter Order ID">
                        </div>
                        <div>
                            <label for="author" class="form-label">Order Author</label>
                            <input type="text" name="author" class="form-control" id="author" placeholder="Enter Order Creator">
                        </div>
                        <button type="submit" class="btn btn-primary text-primary-emphasis text-bg-primary btn-lg rounded-pill me-4 mt-4">Join Order</button>
                    </form>
                <% } else { } %>
            </div>
        </div>
        <div class="bg-circle-1 bg-circle bobble-effect-10"></div>
        <div class="bg-circle-2 bg-circle bobble-effect-8"></div>
        <div class="bg-circle-3 bg-circle bobble-effect-6"></div>
        <div class="bg-circle-4 bg-circle bobble-effect-4"></div>
    </header>
    <script>
        const form = document.querySelector('form')

        const idInput = document.getElementById('id')
        const authorInput = document.getElementById('author')

        form.onsubmit = (e) => {
            e.preventDefault()

            const id = parseInt(idInput.value.trim())
            const author = authorInput.value.trim()

            if(id > 0 && author)
                window.location.href = `/order/${id}/${author}`
        }
    </script>
</body>
</html>